---
title: "Visualiza√ß√£o de dados"
subtitle: "üìà+üòé"
author: "<img src = 'https://d33wubrfki0l68.cloudfront.net/9b0699f18268059bdd2e5c21538a29eade7cbd2b/67e5c/img/logo/cursor1-5.png' width = '30%'>"
date: "`r paste(lubridate::month(Sys.Date(), label = TRUE, abbr = FALSE, locale = 'pt_BR.UTF-8'), 'de', lubridate::year(Sys.Date()))`"
output:
  xaringan::moon_reader:
    css: ["default", "default-fonts", "css/xaringan-themer.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:11"
knit: pagedown::chrome_print
---

```{r setup, include=FALSE}
library(ggplot2)
library(dados)
options(htmltools.dir.version = FALSE)
link <- function(href, ...) {
  htmltools::a(
    href = href,
    target = "_blank",
    ...
  )
}
knitr::opts_chunk$set(
  echo = FALSE, 
  fig.align='center',
  warning=FALSE
)
xaringanExtra::use_panelset()
```

class: middle, center

# Sobre a Curso-R

---

## A empresa

<br>

```{r, echo = FALSE, out.width="50%", fig.align="center"}
knitr::include_graphics("https://d33wubrfki0l68.cloudfront.net/295643c6243701ae6a9bac3fb8ad467ff0ce3c84/d1785/img/logo/cursor1-41.png")
```

<br>
<br>

```{r, echo = FALSE, out.width="40%", fig.align="center"}
knitr::include_graphics("img/logo_r6.png")
```

---

## Filosofia de c√≥digo aberto!

.pull-left[
```{r, echo = FALSE}
htmltools::h3("Livros")

link(
  href = "https://livro.curso-r.com/",
  htmltools::img(src = "img/hex-livro.png", width = "100px")
)

link(
  href = "https://curso-r.github.io/zen-do-r/index.html",
  htmltools::img(
    src = "img/zen-do-r.png",
    width = "100px",
    style = "margin-left: 20px;"
  )
)
```

<br>

```{r, echo = FALSE}
htmltools::h3("Lives")
link(
  href = "https://www.youtube.com/c/CursoR6",
  htmltools::img(src = "img/youtube.png", width = "200px")
)
```
]

.pull-right[
```{r, echo = FALSE}
htmltools::h3("Material dos cursos")
link(
  href = "https://github.com/curso-r",
  htmltools::img(src = "img/github.png", width = "230px")
)
```

<br>

```{r, echo = FALSE}
htmltools::h3("Blog")
link(
  href = "https://blog.curso-r.com/",
  htmltools::img(src = "img/blog.png", width = "400px")
)
```
]

<br>

.center[
### [www.curso-r.com](https://www.curso-r.com)
]


---
## Nossos cursos

```{r, echo = FALSE}
templatesR6::criar_slide_nossos_cursos()
```

---
class: middle, center

# Sobre o curso

---
## Din√¢mica curso

- As aulas ter√£o uma se√ß√£o te√≥rica, de exposi√ß√£o de conceitos, e pr√°tica, de aplica√ß√£o de conceitos.

- O objetivo dos exerc√≠cios √© gerar d√∫vidas. **Com exce√ß√£o do trabalho final, nenhum exerc√≠cio precisa ser entregue**.

- O certificado ser√° emitido mediante uma **entrega final**, a ser detalhada a seguir. 

- Haver√° monitoria para esclarecimento de d√∫vidas sempre 30 minutos antes do in√≠cio das aulas.

- Usaremos os √∫ltimos minutos de cada aula para tirar d√∫vidas do conte√∫do apresentado. N√£o haver√° plant√£o de d√∫vidas p√≥s aula.

- A grava√ß√£o das aulas ficar√° dispon√≠vel no Google Classroom por 1 ano ap√≥s o final do curso.

---
## Din√¢mica das aulas

- Mande d√∫vidas e coment√°rios no chat em qualquer momento.

- Para falar, levante a m√£o.

- Algumas d√∫vidas ser√£o respondidas na hora. Outras ser√£o respondidas mais tarde na pr√≥pria aula ou em aulas futuras.

---
## Trabalho final

Para o TCC do curso, entregar√° um TidyTuesday! 

```{r}
#| out.width: 60%
knitr::include_graphics("https://github.com/rfordatascience/tidytuesday/raw/master/static/tt_logo.png")
```


O TidyTuesday √© um evento semanal criado para engajar a comunidade no uso do R para an√°lise de dados. Se quiser conhecer mais, [siga a hashtag #tidytuesday no Twitter](https://twitter.com/hashtag/TidyTuesday)!

Mais informa√ß√µes [aqui](https://github.com/rfordatascience/tidytuesday/).

---
## Trabalho final

O resultado dever√° ser entregue em um __arquivo zip__ contendo as visualiza√ß√µes e c√≥digos. A submiss√£o deve ser feita pelo classroom, subindo um arquivo .zip contendo

- Os __c√≥digos em R__ utilizados para gerar os gr√°ficos.
- Os __gr√°ficos em imagens__ (.png, .jpeg, .gif etc)
- Um arquivo __README.md__ contando qual foi sua ideia e o processo de constru√ß√£o das visualiza√ß√µes.

__Observa√ß√µes__

- N√£o √© necess√°rio que a __base de dados__ esteja no reposit√≥rio, j√° que ela pode ser lida diretamente da internet.
- __RMarkdown/Quarto__. Se voc√™ estiver confort√°vel com relat√≥rios reprodut√≠veis, pode entregar o trabalho em um relat√≥rio ou apresenta√ß√£o √† sua escolha. Nesse caso, envie output final (em HTML, PDF, Word, etc) no lugar das imagens.
- __GitHub__. Se voc√™ estiver confort√°vel com Git/GitHub, pode entregar o link do reposit√≥rio no lugar do zip.

---
## Tire suas d√∫vidas

- **N√£o fique com d√∫vidas**.
 
- Fora do hor√°rio de aula ou monitoria:
    - envie suas perguntas gerais **sobre o curso** no Classroom.
     
    - envie preferencialmente suas perguntas **sobre R** no [nosso discourse](https://discourse.curso-r.com/).

- Saber fazer a pergunta certa vai te ajudar bastante nos estudos de programa√ß√£o. [Veja aqui dicas de como fazer uma boa pergunta](https://discourse.curso-r.com/t/como-escrever-uma-boa-pergunta/542).

---
class: middle, center, inverse

# Introdu√ß√£o

---
# Objetivos de aprendizagem

‚¨ú Compreender o papel da visualiza√ß√£o em um projeto de ci√™ncia de dados.

--

‚¨ú Compreender as diferen√ßas entre an√°lise explorat√≥ria e an√°lise descritiva.

--

‚¨ú Entender o funcionamento b√°sico do pacote `{ggplot2}`.

--

‚¨ú Utilizar o `{ggplot2}` em um problema concreto.

--

Ficaremos com esses conte√∫dos por 2 aulas!

---

# O que √© visualiza√ß√£o de dados?

.pull-left[

- √â a representa√ß√£o de dados em gr√°ficos, tabelas e diagramas que podem ser interpretados por pessoas.

- √â uma √°rea interdisciplinar, misturando estat√≠stica, arte e comunica√ß√£o.

- √â uma parte da √°rea de *data storytelling*, que envolve organizar todos os resultados de uma an√°lise de dados em uma ordem l√≥gica para comunicar de forma efetiva com a audi√™ncia.

]

.pull-right[

```{r}
knitr::include_graphics("https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/dog_treats_pipe.jpg")
```

Ilustra√ß√£o de [Allison Horst](https://www.allisonhorst.com)

]

---

# Por que fazer visualiza√ß√µes de dados?

.pull-left[

- Visualiza√ß√µes est√£o presentes na grande maioria dos projetos de ci√™ncia de dados.

- √â a parte mais acess√≠vel da ci√™ncia de dados do ponto de vista de quem l√™. Mostrar uma visualiza√ß√£o costuma ser mais efetivo do que a sa√≠da de um modelo.

- √â uma das partes mais dif√≠ceis de automatizar da ci√™ncia de dados. Uma carreira em *dataviz* dificilmente ficar√° obsoleta.

]

.pull-right[

```{r}
knitr::include_graphics("https://blog.curso-r.com/images/posts/conteudo/sf-miojo/mapa_muni_bonito_uf_cat.webp")
```

Imagem do [blog da Curso-R](https://blog.curso-r.com/posts/2019-02-10-sf-miojo/)

]

---

# Para que servem as visualiza√ß√µes?

.pull-left[

- Uma base de dados cont√©m toda a informa√ß√£o que precisamos.

- No entanto, n√£o somos capazes de tirar conclus√µes apenas olhando essas bases.

- Por isso, √© necess√°rio resumir esses dados em estat√≠sticas.

- Nem sempre as estat√≠sticas (os n√∫meros) s√£o √∫teis para uma comunica√ß√£o efetiva... Por isso, faz sentido mostr√°-las usando formas, cores e outros elementos que facilitam a absor√ß√£o da informa√ß√£o pelas pessoas.

- Para o [Hadley Wickham](https://hadley.nz), visualizar dados serve para .blue[***surpreender***].

]

.pull-right[

```{r}
knitr::include_graphics("https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/presenting_monster.png")
```

Ilustra√ß√£o de [Allison Horst](https://www.allisonhorst.com)

]

---

# Gr√°ficos bons e ruins

.pull-left[

### Gr√°ficos para evitar

- Barras que n√£o come√ßam no zero
- [Gr√°ficos de pizza](https://forum.abj.org.br/t/graficos-de-pizza-sao-ruins/41) (discut√≠vel!)
- ...

]

--

.pull-right[

### Gr√°ficos para tomar cuidado

- Gr√°ficos com dois eixos
- Gr√°ficos pouco conhecidos
- ...

]

---
class: middle,inverse,center

# Ferramental

---

# Em que momentos utilizamos?

```{r, eval=FALSE}
img <- "img/ciclo-ciencia-de-dados.png" |> 
  magick::image_read() |> 
  magick::image_draw(xlim = c(0,1), ylim = c(0,1))
rect(.65, .8, .95, .95, border = "red", lty = 1, lwd = 5)
rect(.25, .15, .55, 0.05, border = "lightgreen", lty = 1, lwd = 5)
dev.off()
magick::image_write(img, "img/ciclo-ciencia-de-dados-vis.png")
```


```{r, echo=FALSE}
knitr::include_graphics("img/ciclo-ciencia-de-dados-vis.png")
```

---

.pull-left[

## An√°lise explorat√≥ria

- √â um trabalho de __investiga√ß√£o__ de dados
- A ferramenta: precisa ser __r√°pida__ de programar
- O objetivo √© **aprender**

```{r, fig.width=6, fig.height=4}
ggplot2::ggplot(cars) +
  ggplot2::aes(speed, dist) +
  ggplot2::geom_point()
```


]

--

.pull-right[

## An√°lise descritiva

- √â um trabalho de __otimiza√ß√£o visual__
- A ferramenta: precisa ser __customiz√°vel__
- O objetivo √© **comunicar**

```{r, fig.width=6, fig.height=4}
ggplot2::ggplot(cars) +
  ggplot2::aes(speed, dist) +
  ggplot2::geom_point(colour = "darkblue") +
  ggplot2::stat_smooth(
    se = FALSE, colour = "lightgray", method="loess",
    formula = "y~x"
  ) +
  ggplot2::theme_minimal(14) +
  ggplot2::labs(
    title = "A velocidade influencia na dist√¢ncia de parada?",
    subtitle = "Dist√¢ncia necess√°ria para parar o carro",
    caption = "Fonte: Ezekiel, M. (1930) Methods of Correlation Analysis. Wiley",
    x = "Velocidade",
    y = "Dist√¢ncia para parar"
  )
```


]

--

.center[
### O `{ggplot2}` permite fazer as duas coisas!
]



---

# Gram√°tica de gr√°ficos *em camadas*

O pacote `{ggplot2}` segue duas filosofias que nos ajudam a entender o processo de constru√ß√£o dos gr√°ficos:

1. Um gr√°fico estat√≠stico √© uma representa√ß√£o visual dos dados por meio de atributos est√©ticos (posi√ß√£o, cor, forma, tamanho, ...) de formas geom√©tricas (pontos, linhas, barras, ...). [The Grammar of Graphics](https://www.springer.com/gp/book/9780387245447).

2. Um gr√°fico pode ser constru√≠do em camadas (um gr√°fico √© a sobreposi√ß√£o de elementos visuais). [A layered grammar of graphics](https://vita.had.co.nz/papers/layered-grammar.html).

---

# Camadas

Para construir um gr√°fico, come√ßamos com o *canvas*. A fun√ß√£o `ggplot()` cria a primeira camada do nosso gr√°fico: uma tela em branco (cinza).

```{r dpi=300, out.width="50%"}
cars |> 
  ggplot()
```

---

# Camadas

.panelset[

.panel[
.panel-name[Canvas]

```{r canvas, dpi=300, out.width="40%"}
cars |> 
  ggplot()
```

]

.panel[
.panel-name[Canvas (R)]

```{r, canvas, echo=TRUE, dpi=300, out.width="40%"}
```

]

.panel[
.panel-name[Eixos]

```{r aes-mapping, dpi=300, out.width="40%"}
cars |> 
  ggplot() +
  aes(x = speed, y = dist)
```

]


.panel[
.panel-name[Eixos (R)]

```{r, aes-mapping, echo=TRUE, dpi=300, out.width="40%"}
```

]

.panel[
.panel-name[Geometria]

```{r dispersao, dpi=300, out.width="40%"}
cars |> 
  ggplot() +
  aes(x = speed, y = dist) +
  geom_point()
```

]

.panel[
.panel-name[Geometria (R)]

```{r, dispersao, echo=TRUE, dpi=300, out.width="40%"}
```

]
]

---

# Camadas

Depois, podemos trabalhar a est√©tica com temas e detalhamentos.

.panelset[
.panel[
.panel-name[Completo]

```{r cars-completo, fig.width=9, fig.height=6, dpi=300}
ggplot(cars) +
  aes(speed, dist) +
  geom_point(colour = "darkblue") +
  stat_smooth(
    se = FALSE, colour = "lightgray", 
    method = "loess", formula = "y ~ x"
  ) +
  theme_minimal(14) +
  labs(
    title = "A velocidade influencia na dist√¢ncia de parada?",
    subtitle = "Dist√¢ncia necess√°ria para parar o carro",
    caption = paste(
      "Fonte: Ezekiel, M. (1930) Methods of",
      "Correlation Analysis. Wiley"),
    x = "Velocidade", y = "Dist√¢ncia para parar"
  )
```

]
.panel[
.panel-name[Completo (R)]

```{r, cars-completo, fig.width=9, fig.height=6, echo=TRUE}
```

]
]

---

# Curiosidade: por que o `+`?

O `{ggplot2}`, diferentemente dos outros pacotes do `tidyverse`, n√£o usa o *pipe* (`|>` ou `|>` depois do R 4.1). Isso acontece pois o `{ggplot2}` surgiu [antes que o autor tomasse conhecimento do pipe](https://www.reddit.com/r/dataisbeautiful/comments/3mp9r7/comment/cvi19ly/?utm_source=share&utm_medium=web2x&context=3).

<iframe id="reddit-embed" src="https://www.redditmedia.com/r/dataisbeautiful/comments/3mp9r7/im_hadley_wickham_chief_scientist_at_rstudio_and/cvi19ly/?depth=1&amp;showmore=false&amp;embed=true&amp;showmedia=false" sandbox="allow-scripts allow-same-origin allow-popups" style="border: none;" height="437" width="640" scrolling="no"></iframe>

---

# [D√∫vidas?](https://www.rstudio.com/resources/cheatsheets/)

```{r, out.width="75%"}
knitr::include_graphics("https://raw.githubusercontent.com/rstudio/cheatsheets/main/pngs/data-visualization.png")
```

---

# [Qual gr√°fico escolher?](https://www.data-to-viz.com)

```{r, out.width="90%"}
knitr::include_graphics("img/data-to-viz.png")
```

---

# Base de dados do exemplo

Para os slides a seguir, vamos usar a base do imdb. Aten√ß√£o para a coluna lucro, que criamos fazendo a diferen√ßa entre receita e or√ßamento.

```{r}
#| echo: true
#| eval: false
library(tidyverse)
imdb <- read_rds("dados/imdb.rds")
imdb <- imdb |> mutate(lucro = receita - orcamento)
```


```{r, include=FALSE}
library(tidyverse)
imdb <- read_rds("../dados/imdb.rds")
imdb <- imdb |> mutate(lucro = receita - orcamento)
options(width = 80)
knitr::opts_chunk$set(
  fig.width = 5,
  fig.height = 4,
  fig.align = "center",
  fig.retina = 2
)
```

---
# Um gr√°fico de pontos (dispers√£o)

Podemos fazer um gr√°fico de dispers√£o da receita contra o or√ßamento dos filmes acrescentando a fun√ß√£o `geom_point()` ao c√≥digo anterior.

.tiny[
```{r ggdispersao, echo=TRUE}
imdb |> 
  ggplot() +
  geom_point(aes(x = orcamento, y = receita))
```
]

---
<br><br>

Muitos pontos para discutir:

- Esse gr√°fico tem duas camadas: o canvas, gerado pela fun√ß√£o `ggplot()`, e os pontos, gerado pela fun√ß√£o `geom_point()`.

- Unimos as camadas de um ggplot usando um `+`. Sim, precisamos controlar a nossa vontade de colocar um ` |> ` em vez de `+`, e essa √© uma fonte de erro bem comum. O motivo para precisarmos usar `+` em vez do `|>` √© o pacote ggplot ter nascido primeiro que o pipe.

- A fun√ß√£o `geom_point()` define que a forma geom√©trica (da√≠ o prefixo `geom`) utilizada para representar os dados ser√° pontos. Existe uma fam√≠lia de fun√ß√µes `geom`, sendo que cada uma vai representar uma forma geom√©trica diferente.

- O primeiro argumento de qualquer fun√ß√£o `geom` √© o `mapping`. Esse argumento serve para mapear os dados nos atributos est√©ticos da forma geom√©trica escolhida. Ele sempre receber√° a fun√ß√£o `aes()`. No c√≥digo, n√≥s omitimos o nome do argumento, mas poder√≠amos ter escrito `geom_point(mapping = aes(x = orcamento, y = receita))`.

---
<br><br>

- A fun√ß√£o `aes()` serve para *mapear os dados aos elementos est√©ticos do gr√°fico*. Os argumentos dela v√£o sempre depender da forma geom√©trica que estamos utilizando. No caso de um gr√°fico de pontos, precisamos definir como as posi√ß√µes do eixo x e y ser√£o constru√≠das. No exemplo, a posi√ß√£o do ponto no eixo x ser√° dada pela coluna `orcamento` e a posi√ß√£o do ponto no eixo y ser√° dada pela coluna `receita`.

- O *warning* indica quantas observa√ß√µes (linhas) precisaram ser removidas, por n√£o possuir informa√ß√£o de or√ßamento ou receita.

- Veremos nos pr√≥ximos exemplos que ser√° muito comum manipularmos a base (aplicarmos diversas fun√ß√µes do `dplyr`, por exemplo) antes de chamarmos a fun√ß√£o `ggplot`. 

**O mapeamento das COLUNAS nas FORMAS GEOM√âTRICAS deve ser SEMPRE feito dentro da fun√ß√£o `aes()`**.

---
<br><br>

Vamos agora inserir um novo elemento visual ao gr√°fico: a reta x = y.

.tiny[
```{r ggreta, echo=TRUE}
imdb |>
  ggplot() +
  geom_point(aes(x = orcamento, y = receita)) +
  geom_abline(intercept = 0, slope = 1, color = "red")
```
]

---
<br><br>

- A reta x = y √© acrescentada ao gr√°fico pela fun√ß√£o `geom_abline()`. Esse `geom` pode ser utilizado para desenhar qualquer reta do tipo `y = a + b * x`, sendo `a` o intercepto (*intercept*) da reta e `b` o seu coeficiente angular (*slope*).

- Essa reta nos permite observar o n√∫mero de filmes que obtiveram lucro (pontos acima da reta) e aqueles que obtiveram preju√≠zo (pontos abaixo da reta).

- Como n√£o estamos mapeando colunas a essa reta, n√£o precisamos colocar os argumentos da fun√ß√£o `geom_abline()` do `aes()`.

---
<br><br>

Veja como o ggplot realmente √© constru√≠do por camadas. Agora, colocamos a camada da reta antes da camada dos pontos. Os pontos ficam em cima da reta.

.tiny[
```{r ggretavermelha, echo=TRUE}
imdb |>
  ggplot() +
  geom_abline(intercept = 0, slope = 1, color = "red") +
  geom_point(aes(x = orcamento, y = receita))
```
]

---
<br><br>

Os atributos `x` e `y` s√£o necess√°rios para construirmos um gr√°fico de pontos. Outros atributos tamb√©m podem ser mapeados em pontos, como a cor. Como a coluna `lucro` √© num√©rica, um degrad√™ de cores √© criado para os pontos, a depender do lucro.

.tiny[
```{r ggdispersaoazul, echo=TRUE}
imdb |>
  ggplot() +
  geom_point(aes(x = orcamento, y = receita, color = lucro))
```
]

---
<br><br>

Poder√≠amos tamb√©m classificar os filmes entre aqueles que lucraram ou n√£o. Uma cor √© atribu√≠da a cada categoria.

.tiny[
```{r gglucro, echo=TRUE}
imdb |>
  mutate(
    lucrou = ifelse(lucro <= 0, "N√£o", "Sim")
  ) |>
  ggplot() +
  geom_point(aes(x = orcamento, y = receita, color = lucrou))
```
]

---
# Gr√°fico de linhas

Utilizamos o `geom_line` para fazer gr√°ficos de linhas. Gr√°ficos de linha s√£o muito utilizados para representar *s√©ries temporais*, isto √©, observa√ß√µes medidas repetidamente em intervalos (em geral) equidistantes de tempo.

Assim como nos gr√°ficos de pontos, precisamos definir as posi√ß√µes `x` e `y` para construirmos gr√°ficos de linhas.

A seguir, constru√≠mos o gr√°fico das notas m√©dias dos filmes produzidos em cada ano, 

---
<br><br>

.tiny[
```{r gglinha, fig.width = 8, fig.height = 4, echo=TRUE}
imdb |> 
  group_by(ano) |> 
  summarise(nota_media = mean(nota_imdb, na.rm = TRUE)) |> 
  ggplot() +
  geom_line(aes(x = ano, y = nota_media))
```
]

---
<br><br>

Se mapearmos uma coluna √† cor das retas, ser√£o constru√≠das uma reta correspondente a cada categoria distinta dessa coluna.

.tiny[
```{r gglinhacolorida, fig.width = 8, fig.height = 3, echo=TRUE}
imdb |> 
  filter(!is.na(idioma)) |> 
  mutate(idioma_ingles = case_when(idioma == "English" ~ "Apenas Ingl√™s",
                                   str_detect(idioma, "English") ~ "Ingl√™s e outros idiomas",
                                   TRUE ~ "Outros idiomas")) |>
  group_by(ano, idioma_ingles) |> 
  summarise(num_filmes = n(), .groups = "drop") |> 
  ggplot() +
  geom_line(aes(x = ano, y = num_filmes, color = idioma_ingles))
```
]

---
<br><br>

Podemos colocar pontos e retas no mesmo gr√°fico. Basta acrescentar os dois `geoms`. O gr√°fico abaixo mostra nota m√©dia anual dos filmes do Robert De Niro.

```{r ggdeniro, fig.width = 8, fig.height = 3, echo=TRUE}
imdb |> 
  filter(str_detect(elenco, "Robert De Niro")) |> 
  group_by(ano) |> 
  summarise(nota_media = mean(nota_imdb, na.rm = TRUE)) |> 
  ggplot() +
  geom_line(aes(x = ano, y = nota_media)) +
  geom_point(aes(x = ano, y = nota_media))
```

---
<br><br>

Quando precisamos usar o mesmo `aes()` em v√°rios `geoms`, podemos defini-lo dentro da fun√ß√£o `ggplot()`. Esse `aes()` ser√° ent√£o distribu√≠do para todo `geom` do gr√°fico. O c√≥digo anterior pode ser reescrito da seguinte forma.

```{r gglinhaponto, fig.width = 8, fig.height = 3, echo=TRUE}
imdb |> 
  filter(str_detect(elenco, "Robert De Niro")) |> 
  group_by(ano) |> 
  summarise(nota_media = mean(nota_imdb, na.rm = TRUE)) |> 
  ggplot(aes(x = ano, y = nota_media)) +
  geom_line() +
  geom_point()
```

---
<br><br>

Se algum `geom` necessitar de um atributo que os outros n√£o precisam, esse atributo pode ser especificado normalmente dentro dele. Abaixo, utilizamos o `geom_label` para colocar as notas m√©dias no gr√°fico. Al√©m do `x` e `y`, o `geom_label` tamb√©m precisa do texto que ser√° escrito no gr√°fico.

.tiny[
```{r gglinhalabel, fig.width = 8, fig.height = 3, echo=TRUE}
imdb |> 
  filter(str_detect(elenco, "Robert De Niro")) |> 
  group_by(ano) |> 
  summarise(nota_media = mean(nota_imdb, na.rm = TRUE)) |> 
  mutate(nota_media = round(nota_media, 1)) |> 
  ggplot(aes(x = ano, y = nota_media)) +
  geom_line() +
  geom_label(aes(label = nota_media))
```
]

---
# Gr√°fico de barras

Para construir gr√°ficos de barras, utilizamos o `geom_col`. A seguir, constru√≠mos um gr√°fico de barras do n√∫mero de filmes das 10 pessoas que mais dirigiram filmes na nossa base do IMDB.

.tiny[
```{r ggbarras, fig.width = 7, fig.height = 3.5, echo=TRUE}
imdb |> 
  count(direcao) |>
  slice_max(order_by = n, n = 10) |> 
  ggplot() +
  geom_col(aes(x = direcao, y = n))
```
]
---
<br><br>

Gr√°ficos de barras tamb√©m precisam dos atributos `x` e `y`, sendo que o atributo `y` representar√° a altura de cada barra.

No gr√°fico anterior, vemos que o `NA` √© considerado uma "op√ß√£o" de direcao e entra no gr√°fico. Podemos retirar os `NAs` dessa coluna previamente utilizando a fun√ß√£o `filter()`.

A seguir, al√©m de retirar os `NAs`, atribu√≠mos a coluna `direcao` √† cor das colunas. Repare que, nesse caso, n√£o utilizamos o atributo `color` e sim `fill`. A regra √© a seguinte: o atributo `color` colore objetos sem √°rea (pontos, linhas, contornos), o atributo `fill` preenche objetos com cor (barras, √°reas, pol√≠gonos em geral).

---
<br><br>

.tiny[
```{r ggbarracolorida, fig.width = 7, fig.height = 3.5, echo=TRUE}
imdb |> 
  count(direcao) |>
  filter(!is.na(direcao)) |> 
  slice_max(order_by = n, n = 10) |> 
  ggplot() +
  geom_col(
    aes(x = direcao, y = n, fill = direcao), show.legend = FALSE
  )
```
]

---
<br><br>

Para consertar as labels do eixo `x`, uma alternativa √© inverter os eixos do gr√°fico, construindo barras horizontais.

.tiny[
```{r ggbarracoordflip, fig.width = 7, fig.height = 3.5, echo=TRUE}
imdb |> 
  count(direcao) |>
  filter(!is.na(direcao)) |> 
  slice_max(order_by = n, n = 10) |> 
  ggplot() +
  geom_col(
    aes(x = direcao, y = n, fill = direcao), show.legend = FALSE
  ) +
  coord_flip()
```
]

---
<br><br>

Para ordenar as colunas, precisamos mudar a ordem dos n√≠veis do *fator* `direcao`. Para isso, utilizamos a fun√ß√£o `fct_reorder()` do pacote `forcats`. A nova ordem ser√° estabelecida pela coluna `n` (quantidade de filmes).

Fatores dentro do R s√£o n√∫meros inteiros (1, 2, 3, ...) que possuem uma representa√ß√£o textual. Vari√°veis categ√≥ricas s√£o transformadas em fatores pelo ggplot pois todo eixo cartesiano √© num√©rico. Assim, os textos de uma vari√°vel categ√≥rica s√£o, internamente, n√∫meros inteiros.

Por padr√£o, os inteiros s√£o atribu√≠dos a cada categoria de uma vari√°vel pela ordem alfab√©tica (repare na ordem das pessoas que dirigiram filmes nos gr√°ficos anteriores). Assim, se transform√°ssemos o vetor `c("banana", "uva", "melancia")` em um fator, a atribui√ß√£o de inteiros seria: "banana" vira 1, "melancia" vira 2 e "uva" vira 3. Embora sejam inteiros internamente, sempre que cham√°ssemos esse novo vetor, ainda sim ver√≠amos os textos "banana", "uva" e "melancia".

---
<br><br>

.tiny[
```{r ggbarraforcats, fig.width = 7, fig.height = 3.5, echo=TRUE}
imdb |> 
  count(direcao) |>
  filter(!is.na(direcao)) |> 
  slice_max(order_by = n, n = 10) |> 
  mutate(direcao = forcats::fct_reorder(direcao, n)) |> 
  ggplot() +
  geom_col(
    aes(x = direcao, y = n, fill = direcao),
    show.legend = FALSE
  ) +
  coord_flip()
```
]

---
<br><br>

Por fim, podemos colocar uma label com o n√∫mero de filmes de cada pessoa que dirigiu filmes dentro de cada barra.

.tiny[
```{r ggbarralabel, fig.width = 7, fig.height = 3.5, echo=TRUE}
imdb |> 
  count(direcao) |>
  filter(!is.na(direcao)) |> 
  slice_max(order_by = n, n = 10) |> 
  mutate(direcao = forcats::fct_reorder(direcao, n)) |> 
  ggplot() +
  geom_col(aes(x = direcao, y = n, fill = direcao), show.legend = FALSE) +
  geom_label(aes(x = direcao, y = n/2, label = n)) +
  coord_flip()
```
]

---
# Histograma

Para construir histogramas, usamos o `geom_histogram`. Esse `geom` s√≥ precisa do atributo `x` (o eixo y √© constru√≠do automaticamente). Histogramas s√£o √∫teis para avaliarmos a distribui√ß√£o de uma vari√°vel.

A seguir, constru√≠mos o histograma do lucro dos filmes do diretor Steven Spielberg.
O primeiro *warning* nos diz que o eixo x foi dividido em 30 intervalos para a constru√ß√£o do histograma.

---
<br><br>

```{r gghist, fig.width = 7, fig.height = 3.5, echo=TRUE}
imdb |> 
  filter(direcao == "Steven Spielberg") |>
  ggplot() +
  geom_histogram(aes(x = lucro))
```

---
<br><br>

Para definir o tamanho de cada intervalo, podemos utilizar o argumento `bindwidth`.

.tiny[
```{r gghistbind, fig.width = 7, fig.height = 3.5, echo=TRUE}
imdb |> 
  filter(direcao == "Steven Spielberg") |>
  ggplot() +
  geom_histogram(
    aes(x = lucro), 
    binwidth = 100000000,
    color = "white"
  )
```
]

---
# Boxplot

Boxplots tamb√©m s√£o √∫teis para estudarmos a distribui√ß√£o de uma vari√°vel, principalmente quando queremos comparar v√°rias distribui√ß√µes. 

Para construir um boxplot no ggplot, utilizamos a fun√ß√£o `geom_boxplot`. Ele precisa dos atributos `x` e `y`, sendo que ao atributo `x` devemos mapear uma vari√°vel categ√≥rica.

A seguir, constru√≠mos boxplots do lucro dos filmes das pessoas que dirigiram de 15 filmes.

---
<br><br>

.tiny[
```{r ggboxplot, fig.width = 7, fig.height = 3.5, echo=TRUE}
direcao_mais_15_filmes <- imdb |> 
  filter(!is.na(direcao), !is.na(lucro) ) |>
  group_by(direcao) |> 
  count(direcao, sort = TRUE) |> 
  filter(n >= 15)
imdb |> 
  filter(direcao %in% direcao_mais_15_filmes$direcao) |> 
  ggplot() +
  geom_boxplot(aes(x = direcao, y = lucro)) +
  coord_flip()
```
]

---
<br><br>

Tamb√©m podemos reordenar a ordem dos boxplots utilizando a fun√ß√£o `forcats::fct_reorder`.

.tiny[
```{r ggboxplotreorder, fig.width = 7, fig.height = 3.5, echo=TRUE}
imdb |> 
  filter(direcao %in% direcao_mais_15_filmes$direcao) |> 
  mutate(direcao = forcats::fct_reorder(direcao, lucro, .na_rm = TRUE)) |> 
  ggplot() +
  geom_boxplot(aes(x = direcao, y = lucro)) +
  coord_flip()
```
]

---
# T√≠tulos, labels e escalas

Para colocar t√≠tulos no gr√°fico ou trocar as labels dos atributos, utilizamos a fun√ß√£o `labs()`. 

Para mudar as escalas (textos e quebras), utilizamos as fun√ß√µes da fam√≠lia `scale_`.

Podemos usar a fun√ß√£o `coord_cartesian()` para definir qual por√ß√£o do gr√°fico deve ser mostrada.

---
<br><br>

Colocando t√≠tulo, subt√≠tulo e mudando as labels.

.tiny[
```{r gglabs, fig.width = 7, fig.height = 3, echo=TRUE}
imdb |>
  ggplot() +
  geom_point(mapping = aes(x = orcamento, y = receita, color = lucro)) +
  labs(
    x = "Or√ßamento ($)", y = "Receita ($)", color = "Lucro ($)",
    title = "Gr√°fico de dispers√£o", subtitle = "Receita vs Or√ßamento"
  )
```
]

---
<br><br>

Mudando as quebras dos eixos `x` e `y`.

.tiny[
```{r ggscale, fig.width = 7, fig.height = 3, echo=TRUE}
imdb |> 
  group_by(ano) |> 
  summarise(nota_media = mean(nota_imdb, na.rm = TRUE)) |> 
  ggplot() +
  geom_line(aes(x = ano, y = nota_media)) +
  scale_x_continuous(breaks = seq(1916, 2016, 10)) +
  scale_y_continuous(breaks = seq(0, 10, 2))
```
]

---
<br><br>

Mudando a escala do gr√°fico.

.tiny[
```{r ggcoordcartesian, fig.width = 7, fig.height = 3, echo=TRUE}
imdb |> 
  group_by(ano) |> 
  summarise(nota_media = mean(nota_imdb, na.rm = TRUE)) |> 
  ggplot() +
  geom_line(aes(x = ano, y = nota_media)) +
  scale_x_continuous(breaks = seq(1916, 2016, 10)) +
  scale_y_continuous(breaks = seq(0, 10, 2)) +
  coord_cartesian(ylim = c(0, 10))
```
]

---
# Cores

Tamb√©m existe fun√ß√µes `scale` para os atributos de cor: `scale_color_` e `scale_fill_`. 

Para escolher manualmente as cores de um gr√°fico, utilize as fun√ß√µes 
`scale_color_manual` e `scale_fill_manual()`.

Para trocar o nome nas legendas geradas por atributos de cor, utilize as fun√ß√µes `scale_color_discrete` e `scale_fill_discrete`.

---
<br><br>

Substituindo as cores padr√£o do gr√°fico por um outro conjunto de cores.

.tiny[
```{r ggfillmanual, fig.width = 7, fig.height = 3, echo=TRUE}
imdb |> 
  count(direcao) |>
  filter(!is.na(direcao)) |> 
  slice_max(order_by = n, n = 5) |> 
  ggplot() +
  geom_col(aes(x = direcao, y = n, fill = direcao), show.legend = FALSE) +
  coord_flip() +
  scale_fill_manual(values = c("red", "blue", "green", "pink", "purple"))
```
]

---
<br><br>

Tamb√©m podemos usar c√≥digos hexadecimais.

.tiny[
```{r ggfillhex, fig.width = 7, fig.height = 3, echo=TRUE}
imdb |> 
  count(direcao) |>
  filter(!is.na(direcao)) |> 
  slice_max(order_by = n, n = 5) |> 
  ggplot() +
  geom_col(aes(x = direcao, y = n, fill = direcao), show.legend = FALSE) +
  coord_flip() +
  scale_fill_manual(
    values = c("#ff4500", "#268b07", "#ff7400", "#0befff", "#a4bdba")
  )
```
]

---
<br><br>

Trocando os textos da legenda.

.tiny[
```{r gglabelslegenda, fig.width = 7, fig.height = 3, echo=TRUE}
imdb |> 
  mutate(sucesso_nota = case_when(nota_imdb >= 7 ~ "sucesso_nota_imbd",
                                  TRUE ~ "sem_sucesso_nota_imdb")) |>
  group_by(ano, sucesso_nota) |> 
  summarise(num_filmes = n(), .groups = "drop") |> 
  ggplot() +
  geom_line(aes(x = ano, y = num_filmes, color = sucesso_nota)) +
  scale_color_discrete(labels = c("Nota menor que 7", "Nota maior ou igual √† 7"))
```
]

---
# Temas

Os gr√°ficos que vimos at√© agora usam o tema padr√£o do ggplot2. Existem outros temas prontos para utilizarmos presentes na fam√≠lia de fun√ß√µes `theme_`.

Voc√™ tamb√©m pode criar o seu pr√≥prio tema utilizando a fun√ß√£o `theme()`. Nesse caso, para trocar os elementos est√©ticos do gr√°fico precisamos usar as fun√ß√µes `element_text()` para textos, `element_line()` para linhas, `element_rect()` para √°reas e `element_blank()` para remover elementos.

---
<br><br>

```{r ggthememinimal, echo=TRUE}
imdb |> 
  ggplot() +
  geom_point(mapping = aes(x = orcamento, y = receita)) +
  theme_minimal() 
```

---
<br><br>

```{r ggthemebw, echo=TRUE}
imdb |> 
  ggplot() +
  geom_point(mapping = aes(x = orcamento, y = receita)) +
  theme_bw()
```

---
<br><br>

```{r ggthemeclassic, echo=TRUE}
imdb |> 
  ggplot() +
  geom_point(mapping = aes(x = orcamento, y = receita)) +
  theme_classic()
```

---
<br><br>

```{r ggthemedark}
imdb |> 
  ggplot() +
  geom_point(mapping = aes(x = orcamento, y = receita)) +
  theme_dark()
```

---
<br><br>

Criando um pr√≥prio tema.

.tiny[

```{r ggthemealterado, fig.width = 7, fig.height = 3, echo=TRUE}
imdb |> 
  ggplot() +
  geom_point(mapping = aes(x = orcamento, y = receita), color = "white") +
  labs(title = "Gr√°fico de dispers√£o", subtitle = "Receita vs Or√ßamento") +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    axis.title = element_text(color = "purple"),
    panel.background = element_rect(fill = "black"),
    panel.grid = element_blank()
  )
```

]

---

# Vamos ao R!

```{r}
knitr::include_graphics("img/cat.gif")
```


---
class: middle, center, inverse

# Otimiza√ß√£o Visual

---
# Objetivos de aprendizagem

‚¨ú Discutir os principais aspectos visuais a serem considerados em um gr√°fico estat√≠stico

--

‚¨ú Compreender como modificar um `ggplot` para comunicar resultados de maneira eficiente.

--

‚¨ú Otimizar um gr√°fico que utilizamos na aula anterior.

---

# O que √© otimiza√ß√£o visual?

- √â o ato de trabalhar em uma visualiza√ß√£o aprimorar a comunica√ß√£o.

- Pode envolver altera√ß√µes nas cores, fontes, elementos geom√©tricos, entre outros, a partir de um gr√°fico explorat√≥rio.

- N√£o √© uma ci√™ncia exata, mas recolhe elementos da ci√™ncia para aumentar a probabilidade de sucesso da visualiza√ß√£o.

---

# Recursos pr√©-atentativos

- Uma propriedade visual pr√©-atentativa √© processada pelo nosso [c√©rebro antes de uma a√ß√£o consciente](https://www.interaction-design.org/literature/article/preattentive-visual-properties-and-how-to-use-them-in-information-visualization).

- Como isso esse processamento √© muito r√°pido, trata-se de uma oportunidade para tornar visualiza√ß√µes mais amig√°veis e diretamente interpretadas.

- Segundo [Colin Ware](https://en.wikipedia.org/wiki/Colin_Ware), existem 4 propriedades pr√©-atentativas que podemos explorar:
    - Cor
    - Forma
    - Movimento
    - Posicionamento
    
- O objetivo dos recursos pr√©-atentativos √© __<span style="color:blue;">chamar a aten√ß√£o</span>__.

---

# Recursos pr√©-atentativos

- Uma propriedade visual pr√©-atentativa √© processada pelo nosso [c√©rebro antes de uma a√ß√£o consciente](https://www.interaction-design.org/literature/article/preattentive-visual-properties-and-how-to-use-them-in-information-visualization).

- Como isso esse processamento √© muito r√°pido, trata-se de uma oportunidade para tornar visualiza√ß√µes mais amig√°veis e diretamente interpretadas.

- Segundo [Colin Ware](https://en.wikipedia.org/wiki/Colin_Ware), existem 4 propriedades pr√©-atentativas que podemos explorar:
    - __Cor__
    - __Forma__
    - Movimento
    - Posicionamento
    
- O objetivo dos recursos pr√©-atentativos √© __<span style="color:blue;">chamar a aten√ß√£o</span>__.

---
class: inverse, middle

##### E por √∫ltimo isso

<br/><br/>

# Primeiro voc√™ ler√° isso

<br/><br/>

### Depois voc√™ ler√° isso

<br/><br/>

#### Ent√£o isso

---
class: middle, center

# Cor

---

# Cores do zero: HCL vs RGB

- HCL (hue, chroma, luminance) √© vantajoso pois √© mais intuitivo de criar do que RGB, j√° que o HCL tem apenas um eixo de cores (*hue*), enquanto RGB √© uma composi√ß√£o de tr√™s (*red*, *green*, *blue*)

- O pacote `{colorspace}` permite usar HCL para definir uma cor/paleta: experimente `colorspace::hcl_color_picker()`

- [Nesse site](https://color.adobe.com/create/color-wheel), tamb√©m √© poss√≠vel criar algumas paletas

```{r, out.width="70%"}
knitr::include_graphics("img/hcl.png")
```

---

# Paletas de cores prontas

- __Escalas qualitativas__: utilizado para vari√°veis nominais (sexo, cor/ra√ßa)

- __Escalas divergentes__: utilizado para vari√°veis que t√™m um centro neutro (favor√°vel/neutro/desfavor√°vel, correla√ß√£o)

- __Escalas sequenciais__: utilizado para vari√°veis ordinais (faixa et√°ria, renda)

- __Viridis__: √∫til para comunicar com pessoas com daltonismo

---

# Paletas de cores no {ggplot2}

- `scale_*_brewer()`: utilizada para vari√°veis discretas. Possui tr√™s tipos: divergente, qualitativa e sequencial.

- `scale_*_distiller()`: utilizada para vari√°veis cont√≠nuas. Interpola as cores do *brewer* para lidar com todos os valores.

- `scale_*_fermenter()`: utilizada para vari√°veis cont√≠nuas, que s√£o transformadas em discretas (binned).

- `scale_*_viridis_[cdb]`: Escala viridis para vari√°veis `c`ont√≠nuas, `d`iscretas ou `b`inned.

- `scale_*_manual()`: inclui um conjunto de cores manualmente.

---

# Paletas de outros pacotes

- [`{ggthemr}`](https://github.com/Mikata-Project/ggthemr) tem um monte de paletas, mas est√° um pouco desatualizado.

- [`{hrbrthemes}`](https://github.com/hrbrmstr/hrbrthemes) cont√©m uma lista de temas escolhidos pelo Bob Rudis.

- [`{ghibli}`](https://ewenme.github.io/ghibli/) tem paletas de cores relacionadas ao Studio Ghibli

- [`{paletteer}`](https://github.com/EmilHvitfeldt/paletteer) tem uma cole√ß√£o de cores de v√°rios outros pacotes de paletas.

---

# Qual visualiza√ß√£o √© melhor?

.pull-left[

```{r, fig.width=5, fig.height=4, dpi = 300}
notas_pixar <- dados::pixar_avalicao_publico |> 
  dplyr::count(nota_cinema_score) |> 
  dplyr::mutate(
    nota = forcats::fct_na_value_to_level(nota_cinema_score, "(vazio)"),
    nota = forcats::fct_relevel(nota, c("A-", "A", "A+", "(vazio)"))
  )
notas_pixar |> 
  ggplot2::ggplot() +
  ggplot2::aes(nota, n) +
  ggplot2::geom_col(width = .5) +
  ggplot2::scale_y_continuous(limits = c(0, 15)) +
  ggplot2::labs(title = "A maioria dos filmes da pixar tem nota 'A'") +
  ggplot2::theme_minimal(12)
```

]


.pull-right[

```{r, fig.width=5, fig.height=4, dpi = 300}
notas_pixar |> 
  dplyr::mutate(cor = dplyr::case_when(
    nota == "A" ~ "b",
    TRUE ~ "a"
  )) |> 
  ggplot2::ggplot() +
  ggplot2::aes(nota, n, fill = cor) +
  ggplot2::geom_col(width = .5, show.legend = FALSE) +
  ggplot2::scale_y_continuous(limits = c(0, 15)) +
  ggplot2::scale_fill_manual(values = c("gray30", "tomato")) +
  ggplot2::labs(title = "A maioria dos filmes da pixar tem nota 'A'") +
  ggplot2::theme_minimal(12)
```

]

---

# √â subjetivo...

```{r}
knitr::include_graphics("img/same-picture.jpg")
```


---
class: middle, center

# Forma

---

# Formas

- Geralmente queremos contrastar formas para chamar a aten√ß√£o...

--

- Sem com isso fazer uma bagun√ßa visual.

--

- A ideia √© utilizar apenas um elemento, como tamanho, forma, largura, marca√ß√µes, angula√ß√µes, etc. para mostrar o contraste.


---

# Exemplos


```{r warning=FALSE, fig.width=9, fig.height=6, dpi=300}
p_size <- notas_pixar |> 
  dplyr::mutate(tipo = dplyr::case_when(
    nota == "A" ~ "b",
    TRUE ~ "a"
  )) |> 
  ggplot2::ggplot() +
  ggplot2::aes(nota, n, size = tipo) +
  ggplot2::geom_segment(ggplot2::aes(xend = nota, yend = 0), size = .5) +
  ggplot2::geom_point() +
  ggplot2::scale_y_continuous(limits = c(0, 15)) +
  ggplot2::scale_size_discrete(range = c(3, 6)) +
  ggplot2::theme_minimal(12) +
  ggplot2::theme(legend.position = "none")


p_shape <- notas_pixar |> 
  dplyr::mutate(tipo = dplyr::case_when(
    nota == "A" ~ "b",
    TRUE ~ "a"
  )) |> 
  ggplot2::ggplot() +
  ggplot2::aes(nota, n, shape = tipo) +
  ggplot2::geom_segment(ggplot2::aes(xend = nota, yend = 0), size = .5) +
  ggplot2::geom_point(size = 6) +
  ggplot2::scale_shape_manual(values = c(1, 16)) +
  ggplot2::scale_y_continuous(limits = c(0, 15)) +
  ggplot2::theme_minimal(12) +
  ggplot2::theme(legend.position = "none")

p_mark <- notas_pixar |> 
  dplyr::mutate(tipo = dplyr::case_when(
    nota == "A" ~ "b",
    TRUE ~ "a"
  )) |> 
  ggplot2::ggplot() +
  ggplot2::aes(nota, n, shape = tipo) +
  ggplot2::geom_segment(ggplot2::aes(xend = nota, yend = 0), size = .5) +
  ggplot2::geom_point(size = 6) +
  ggplot2::scale_shape_manual(values = c(1, 13)) +
  ggplot2::scale_y_continuous(limits = c(0, 15)) +
  ggplot2::theme_minimal(12) +
  ggplot2::theme(legend.position = "none")

p_bar <- notas_pixar |> 
  dplyr::mutate(tipo = dplyr::case_when(
    nota == "A" ~ "b",
    TRUE ~ "a"
  )) |> 
  ggplot2::ggplot() +
  ggplot2::aes(nota, n) +
  ggplot2::geom_col(width = c(.8, .5,.5,.5)) +
  ggplot2::scale_y_continuous(limits = c(0, 15)) +
  ggplot2::theme_minimal(12)

patchwork::wrap_plots(p_size, p_shape, p_mark, p_bar)

```

---

# Princ√≠pios Gestalt

- __Gestalt__ √© uma √°rea ampla da psicologia que n√£o vamos aprofundar.

- Est√° ligada √† ideia de que, em uma visualiza√ß√£o, o todo √© maior do que a soma das partes.

- Dois princ√≠pios Gestalt aplic√°veis em visualiza√ß√£o de dados s√£o a nossa capacidade de:
    - Completar figuras
    - Agrupar objetos

- Ou seja, podemos criar visualiza√ß√µes que ativam essas capacidades.

---

# Qual visualiza√ß√£o √© melhor?

.pull-left[


```{r, fig.height=4, fig.width=6, dpi = 300}
dados::pinguins |> 
  tidyr::drop_na() |> 
  ggplot2::ggplot() +
  ggplot2::aes(
    x = comprimento_bico, 
    y = profundidade_bico, 
    shape = especie
  ) +
  ggplot2::geom_point() +
  ggplot2::theme_minimal(12) +
  ggplot2::labs() +
  ggplot2::theme(legend.position = "bottom")

```

]

.pull-right[


```{r, fig.height=4, fig.width=6, dpi = 300}
dados::pinguins |> 
  tidyr::drop_na() |> 
  ggplot2::ggplot(ggplot2::aes(
    x = comprimento_bico, 
    y = profundidade_bico, 
    shape = especie,
    group = especie
  )) +
  ggplot2::geom_point() +
  ggplot2::theme_minimal(12) +
  ggplot2::theme(legend.position = "bottom") +
  ggplot2::stat_ellipse(
    type = "norm", 
    geom = "polygon",
    alpha = .05,
    level = .95,
    colour = "transparent"
  )
```

]

---

# Vamos ao R!

```{r}
knitr::include_graphics("img/cat.gif")
```

---
class: inverse, middle, center

# Extens√µes do ggplot2

---

# Objetivos de aprendizagem

‚¨ú Conhecer extens√µes do `{ggplot2}`

‚¨ú Experimentar extens√µes separadamente

‚¨ú Estudar um exemplo juntando v√°rias extens√µes.

---

# O que √© uma extens√£o?

- O `{ggplot2}` √© maravilhoso, mas n√£o possui todos os gr√°ficos poss√≠veis.

- Por isso, pessoas do mundo todo desenvolvem extens√µes para a comunidade usar, que v√£o desde pacotes com novos temas/cores, geometrias eixos at√© a [possibilidade de desenhar gatinhos em barras](https://coolbutuseless.github.io/package/ggpattern/index.html)

- A equipe do tidyverse mant√©m uma [lista curada de extens√µes do `{ggplot2}`](https://exts.ggplot2.tidyverse.org/gallery/)

---

# Como criar uma extens√£o?

- A [edi√ß√£o mais recente](https://ggplot2-book.org/extensions.html) do livro do `{ggplot2}` possui um tutorial de como criar extens√µes para o pacote.

- ‚ö†Ô∏è  Cuidado! Criar extens√µes do `{ggplot2}` n√£o √© f√°cil. Trata-se de um pacote complexo, exigindo bastante conhecimento de elementos internos do R.

- Uma forma legal de estudar extens√µes √© olhando o c√≥digo de pacotes. Recomendamos as extens√µes do [Thomas Lin Pedersen](https://github.com/thomasp85), j√° que ele √© o mantenedor atual do `{ggplot2}` e, portanto, conhece muito bem as melhores pr√°ticas para criar extens√µes.

---

# Vamos ao R!

```{r}
knitr::include_graphics("img/cat.gif")
```

---
class: inverse, middle, center

# Interatividade

---

# Objetivos de aprendizagem

‚¨ú Conhecer a diferen√ßa entre visualiza√ß√µes est√°ticas e din√¢micas

‚¨ú Experimentar algumas visualiza√ß√µes

‚¨ú Cobrir temas que n√£o foram abordados no curso e encerrar.

---

## Gr√°ficos interativos e est√°ticos

- Gr√°ficos interativos t√™m o poder de engajar mais, por conta do efeito *voosh*. Todo ser humano gosta de interagir com aquilo que est√° analisando.

- No entanto, isso vem com um custo: n√£o s√£o todos os documentos capazes de processar visualiza√ß√µes din√¢micas. Em particular, PDF, Word e PPT n√£o rodam esses conte√∫dos.

- Vamos visitar tanto o mundo est√°tico quanto din√¢mico, para que voc√™ saiba por onde come√ßar quando receber um novo desafio.


---

## htmlwidgets

`htmlwidgets` s√£o bibliotecas de visualiza√ß√£o JavaScript encapsuladas em pacotes de R. Elas nos permitem usar diversas ferramentas JavaScript diretamente do R, adicionando algumas poucas linhas de c√≥digo em nosso script.

Usando `htmlwidgets`, conseguimos construir tabelas, gr√°ficos, mapas e muito outras visualiza√ß√µes interativas e naturalmente bonitas.

[Clique aqui](https://www.htmlwidgets.org/index.html) para acessar uma lista completa de todos os `htmlwidgets` dispon√≠veis.

---
## Tabelas com reactable

O pacote `reactable` nos permite criar tabelas interativas baseadas na biblioteca [React Table](https://github.com/tannerlinsley/react-table). 

[Clique aqui](https://glin.github.io/reactable/) para acessar o tutorial completo do pacote `{reactable}`.

---
<br><br>

A interatividade dos `htmlwidgets` n√£o depende de uma sess√£o R rodando por tr√°s. Voc√™ pode utiliz√°-los em qualquer documento `.html`.

```{r, results='asis'}
reactable::reactable(mtcars, compact = TRUE, defaultPageSize = 4, 
                     striped = TRUE)
```


---
## Pacotes alternativos para tabelas

A seguir, uma lista de pacotes/fun√ß√µes alternativos que trazem solu√ß√µes para visualiza√ß√£o de tabelas.

- `knitr::kable()`: n√£o √© um htmlwidget (n√£o possui interatividade), mas √© uma solu√ß√£o para formatar tabelas quando n√£o precisamos que elas sejam interativas. Funciona em conjunto com o pacote `{kableExtra}`.

- `{flextable}`: tamb√©m n√£o √© interativo, √© um excelente pacote para editar tabelas. Funciona quando trabalhamos com relat√≥rios em Word, e tamb√©m integra bem com o pacote `{DT}`.

- `DT::datatable()`: outro htmlwidget para criar tabelas interativas. Funciona tal como o `reactable()`, mas um pouco mais burocr√°tico para formatar as tabelas. Baseado na biblioteca JavaScript [DataTables](http://datatables.net/).

#### Tutoriais

- [Tutorial kable e kableExtra](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)

- [Tutorial flextable](https://ardata-fr.github.io/flextable-book/)

- [Tutorial DT](https://rstudio.github.io/DT/)

---
## Gr√°ficos com plotly

O pacote `plotly` nos permite criar gr√°ficos interativos baseados na biblioteca [Plotly](https://plotly.com/) (constru√≠da em [D3](https://d3js.org/)). 

Embora seja poss√≠vel criar um plotly do zero usando a fun√ß√£o `plot_ly()`, um jeito muito eficiente de utilizar essa biblioteca √© criar um ggplot e ent√£o utilizar a fun√ß√£o `ggplotly()`. Veja o exemplo a seguir.

#### Tutoriais

- [Tutorial plotly](https://plotly.com/r/)

- [Interactive web-based data visualization with R, plotly, and shiny](https://plotly-r.com/)

---
<br><br>

.pull-left[

```{r echo=TRUE, eval=FALSE}
gg <- ggplot(mtcars) +
  aes(wt, mpg) +
  geom_point()
plotly::ggplotly(
  p = gg, 
  height = 400
)
```

]

.pull-right[

```{r}
gg <- ggplot(mtcars) +
  aes(wt, mpg) +
  geom_point()
plotly::ggplotly(
  p = gg, 
  height = 400
)
```


]


---
## Pacotes alternativos

A seguir, uma lista de pacotes/fun√ß√µes alternativos que trazem solu√ß√µes para visualiza√ß√£o de gr√°ficos.

- `highcharter::highcharter()`: pacote gr√°fico baseado na biblioteca JavaScript [Highcharts](https://www.highcharts.com/). A biblioteca Highcharts √© gratuita apenas para fins educacionais e n√£o lucrativos (exceto √≥rg√£os governamentais). Para outros usos, voc√™ pode precisar de uma licen√ßa. **[avan√ßado]**

- Procure por pacotes para tipos espec√≠ficos de gr√°ficos na [galeria de htmlwidgets](http://gallery.htmlwidgets.org/).

#### Tutoriais

- [Tutorial highcharter](http://jkunst.com/highcharter/)

- [Documenta√ß√£o Highcharts](https://api.highcharts.com/highcharts/)

---
## Mapas com leaflet

O pacote `{leaflet}` nos permite criar mapas interativos baseados na biblioteca  JavaScript open-source [Leaflet](https://leafletjs.com/).

Para criar um mapa leaflet, utilizamos a fun√ß√£o `leaflet::leaflet()` e diversas fun√ß√µes auxiliares para caracterizar nosso mapa. Um tutorial de como utilizar o `leaflet` se encontra [aqui](http://rstudio.github.io/leaflet/).

A seguir, mostramos um exemplo simples de como criar um mapa leaflet.

---
<br><br>


```{r echo=TRUE}
library(leaflet)

leaflet(height = 300) |>
  addTiles() |>  # Adiciona a camada gr√°fica do OpenStreetMap (padr√£o)
  addMarkers(
    lng = -46.6623969, lat = -23.5581664, 
    popup = "A Curso-R morava aqui antes da pandemia. Agora ela mora no mundo todo!"
  )
```

---
## Pacotes alternativos

- `highcharter::hcmap()`: varia√ß√£o do `highcharter` para mapas, baseada na biblioteca JavaScript [Highcharts](https://www.highcharts.com/maps/demo). **[avan√ßado]**

- [`{tmap}`](https://github.com/mtennekes/tmap): Pacote focado em mapas tem√°ticos.

#### Tutoriais

- [Construindo mapas com o highcharter](http://jkunst.com/highcharter/highmaps.html)

- [Documenta√ß√£o Highmaps](https://api.highcharts.com/highmaps/)

- [Documenta√ß√£o do tmap](https://github.com/mtennekes/tmap)


---
## Refer√™ncias e material extra

.pull-left[

#### htmlwidgets

- [Galeria htmlwidgets](http://gallery.htmlwidgets.org/)

#### reactable

- [A biblioteca React Table](https://github.com/tannerlinsley/react-table)
- [Tutorial reactable](https://glin.github.io/reactable/)

#### DT

- [Tutorial DT](https://rstudio.github.io/DT/)

#### plotly

- [Tutorial plotly](https://plotly.com/r/)

- [Interactive web-based data visualization with R, plotly, and shiny](https://plotly-r.com/)

]

.pull-right[

#### highcharter/highcharts

- [Tutorial highcharter](http://jkunst.com/highcharter/)

- [Biblioteca Highcharts](https://www.highcharts.com/)

- [Galeria Highcharts](https://www.highcharts.com/demo)

- [Documenta√ß√£o Highcharts](https://api.highcharts.com/highcharts/)

#### leaflet

- [Biblioteca Leaflet](https://leafletjs.com/)

- [Tutorial Leaflet](http://rstudio.github.io/leaflet/)

#### highmaps

- [Galeria Highmaps](https://www.highcharts.com/maps/demo)

- [Documenta√ß√£o Highmaps](https://api.highcharts.com/highmaps/)


]

---
# Vamos ao R!

```{r}
knitr::include_graphics("img/cat.gif")
```


---
class: middle, center, inverse

# Fim!

